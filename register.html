<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Aggie Points Register</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; max-width: 500px; }
    input, select { width: 100%; padding: 8px; margin: 8px 0; }
    button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Register for Aggie Points</h1>

  <label for="name">Full Name</label>
  <input type="text" id="name" placeholder="Your name" required>

  <label for="email">Email</label>
  <input type="email" id="email" placeholder="Your email" required>

  <label for="password">Password</label>
  <input type="password" id="password" placeholder="Password" required>

  <label for="studentId">Student ID</label>
  <input type="text" id="studentId" placeholder="Student ID" required>

  <label for="team">Team</label>
  <select id="team" required>
    <option value="">Select your team</option>
    <option>Baseball</option>
    <option>Men’s Basketball</option>
    <option>Women’s Basketball</option>
    <option>Beach Volleyball</option>
    <option>Men’s Cross Country</option>
    <option>Women’s Cross Country</option>
    <option>Equestrian</option>
    <option>Field Hockey</option>
    <option>Football</option>
    <option>Men’s Golf</option>
    <option>Women’s Golf</option>
    <option>Gymnastics</option>
    <option>Lacrosse</option>
    <option>Men’s Soccer</option>
    <option>Women’s Soccer</option>
    <option>Softball</option>
    <option>Swim & Dive</option>
    <option>Men’s Tennis</option>
    <option>Women’s Tennis</option>
    <option>Men’s Track & Field</option>
    <option>Women’s Track & Field</option>
    <option>Volleyball</option>
    <option>Men’s Water Polo</option>
    <option>Women’s Water Polo</option>
  </select>

  <label for="year">Graduation Year</label>
  <select id="year" required>
    <option value="">Select year</option>
    <option>2025</option>
    <option>2026</option>
    <option>2027</option>
    <option>2028</option>
    <option>2029</option>
    <option>2030</option>
  </select>

  <button id="registerBtn">Register</button>

  <!-- Load Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js"></script>

  <!-- Initialize Supabase before using it -->
  <script>
    const SUPABASE_URL = "https://gtnptxnkminqmjnnfxie.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0bnB0eG5rbWlucW1qbm5meGllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4NzA0NTEsImV4cCI6MjA3MjQ0NjQ1MX0.LkEbFzHkyBVjxEFgAm_KL30buEkkkoMPsBMUeNyRGow";
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>

  <!-- Register function (after Supabase initialized) -->
  <script>
    async function register() {
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const studentId = document.getElementById("studentId").value;
      const team = document.getElementById("team").value;
      const year = document.getElementById("year").value;

      if (!name || !email || !password || !studentId || !team || !year) {
        return alert("Please fill in all fields.");
      }

      try {
        // 1️⃣ Sign up user in Supabase Auth
        const { data: authData, error: authError } = await supabase.auth.signUp({
          email,
          password
        });
        if (authError) throw authError;

        // 2️⃣ Insert user info into 'users' table
        const { error: insertError } = await supabase.from("users").insert([{
          id: authData.user.id,
          name,
          student_id: studentId,
          team,
          year
        }]);
        if (insertError) throw insertError;

        alert("✅ Registration successful! Check your email to confirm.");
        window.location.href = "login.html";

      } catch (error) {
        alert("Error: " + error.message);
      }
    }

    // Bind register button
    document.getElementById("registerBtn").addEventListener("click", register);
  </script>
</body>
</html>
